@model StaffCardDto
<!--begin::Aside-->
<div class="flex-row-auto offcanvas-mobile w-300px w-xxl-400px h-75" id="kt_profile_aside">
    <!--begin::Profile Card-->
    <div class="card card-custom card-stretch">
        <!--begin::Body-->
        <div class="card-body pt-4">
            <!--begin::Toolbar-->
            <div class="d-flex justify-content-end">
                <div class="dropdown dropdown-inline">
                    <a href="#" class="btn btn-clean btn-hover-light-primary btn-sm btn-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="ki ki-bold-more-hor"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-sm dropdown-menu-right">
                        <!--begin::Navigation-->
                        <ul class="navi navi-hover">
                            <li class="navi-item bg-danger">
                                <a href="#" class="navi-link">
                                    <span class="navi-icon">
                                        <i class="flaticon2-drop"></i>
                                    </span>
                                    <span class="navi-text">İşten Çıkart</span>
                                </a>
                            </li>
                        </ul>
                        <!--end::Navigation-->
                    </div>
                </div>
            </div>
            <!--end::Toolbar-->
            <!--begin::User-->
            <div class="d-flex align-items-center">
                <!--begin::Card-->

                <form method="post" enctype="multipart/form-data">
                    <div class="card-body">
                        <div class="form-group row">
                            <div class="col-lg-9 col-xl-6">
                                @{
                                    var pp = "";
                                    if (Model.PictureUrl != null)
                                    {
                                        pp = "/img/" + @Model.PictureUrl;

                                    }
                                    else
                                    {
                                        pp = "/assets/media/users/default.jpg";
                                    }
                                }

                                <div class="image-input image-input-outline" id="kt_profile_avatar" style="background-image: url(@pp) ">
                                    <div class="image-input-wrapper">
                                        <img id="profilePhoto" style="width:100%; height:100%;" src="@pp" />
                                    </div>
                                    <label onclick="UpdateProfilePhotoClick()" class="btn btn-xs btn-icon btn-circle btn-white btn-hover-text-primary btn-shadow xyz" data-action="change" data-toggle="tooltip" title="" data-original-title="Fotoğrafı Güncelle">
                                        <i id="updateProfilePhoto" class="fa fa-pen icon-sm text-muted"></i>
                                        <input type="file" name="profile_avatar" onchange="profileAvatarChange()" id="profile_avatar" accept=".png, .jpg, .jpeg" />
                                        <input type="hidden" name="profile_avatar_remove" />
                                    </label>
                                    @if (Model.PictureUrl != null)
                                    {
                                        <label onclick="removeProfilePhoto(@Model.StaffFileId)" class="btn btn-xs btn-icon btn-circle btn-white btn-hover-text-primary btn-shadow mt-35" data-action="change">
                                            <span class="btn btn-xs btn-icon btn-circle btn-white btn-hover-text-primary btn-shadow" data-toggle="tooltip" title="Fotoğrafı Sil">
                                                <i class="ki ki-bold-close icon-xs text-muted"></i>
                                            </span>
                                        </label>
                                    }
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="StaffId" value="@ViewBag.StaffId" />
                        <button hidden id="saveButton" onclick="saveButtonClick()" class="btn btn-sm bg-primary text-white px-5 ml-5" type="button">Kaydet</button>
                    </div>
                </form>
                <div>
                    <a href="#" class="font-weight-bolder font-size-h5 text-dark-75 text-hover-primary">@Model.NameSurname</a>
                    <div class="text-muted"></div>

                </div>
            </div>

            <!--end::User-->
            <!--begin::Contact-->
            <div class="py-9">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <span class="font-weight-bold mr-2">İşe başlama tarihi:</span>
                    <span class="text-muted ">@Model.JobJoinDate.ToShortDateString()</span>
                </div>
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <span class="font-weight-bold mr-2">Şube:</span>
                    <span class="text-muted ">@Model.BranchName</span>
                </div>
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <span class="font-weight-bold mr-2">Departman:</span>
                    <span class="text-muted ">@Model.DepartmantName</span>
                </div>
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <span class="font-weight-bold mr-2">Unvan:</span>
                    <span class="text-muted ">@Model.Title</span>
                </div>
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <span class="font-weight-bold mr-2">Şirket:</span>
                    <span class="text-muted ">@Model.CompanyName</span>
                </div>
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <span class="font-weight-bold mr-2">Telefon (İş):</span>
                    <span class="text-muted">@Model.PhoneJob</span>
                </div>
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <span class="font-weight-bold mr-2">E-Posta (İş):</span>
                    <a href="#" class="text-muted text-hover-primary">@Model.EmailJob</a>
                </div>
            </div>
        </div>
        <!--end::Body-->
    </div>
    <!--end::Profile Card-->
</div>
<!--end::Aside-->

<!--begin::Page Scripts(used by this page)-->
<script src="~/assets/js/pages/widgets.js"></script>
<script src="~/assets/js/pages/custom/profile/profile.js"></script>
<!--end::Page Scripts-->
<script>
    function profileAvatarChange() {
        if ($("#profile_avatar").val() != "") {
            $(".image-input-wrapper img").remove();
        }
        $("#saveButton").attr('hidden', false);
    }
    function removeProfilePhoto(id) {
        Swal.fire({
            title: "Silmek istediğinize emin misiniz ?",
            text: "Bunu geri alamazsınız!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Evet",
            cancelButtonText: "Hayır",
            reverseButtons: true
        }).then(function (result) {
            if (result.value) {

                $.ajax({
                    method: "POST",
                    url: "/StaffFile/RemoveProfilePhoto/" + id,
                }).done(function (result) {
                    if (result == true) {
                        Swal.fire({
                            title: "Silindi!",
                            text: "Kaydınız silindi.",
                            icon: "success",
                            showCancelButton: false
                        }).then(function () {
                            window.location.reload();
                        })

                    } else {
                        Swal.fire(
                            "Hata",
                            "Kaydınız silinemedi",
                            "hata"
                        )
                    }

                })
            } else if (result.dismiss === "cancel") {
                Swal.fire({
                    title: "İptal Edildi",
                    text: "Kaydınız silinmedi",
                    icon: "error",
                    showCancelButton: false
                })
            }
        });


    }
    function saveButtonClick() {
        var formdata = new FormData();
        $('.xyz').each(function (i, obj) {        
            var myKey = "1";
            var file;
            var itemId = "#profile_avatar";
            $(this).find('input').each(function (j, obj2) {
                if ($(obj2).attr("name") == "profile_avatar" && $(itemId).prop('files') != null) {
                    file = $(itemId).prop('files');
                }

            });      
            if (file.length != 0) {
                formdata.append(myKey, file[0]);
            }
        });
        var id = $("#StaffId").val();

        $.ajax({
            method: 'Post',
            url: '/StaffFile/UpdateProfilePhoto/' + id,
            data: formdata,
            contentType: false,
            cache: false,
            processData: false,

        }).done(function (result) {
          
            if (result == true) {
                Swal.fire({
                    title: "Güncellendi!",
                    text: "Profil fotoğrafınız güncellendi",
                    icon: "success",
                    showCancelButton: false
                }).then(function () {
                    window.location.reload();
                })

            } else {
                Swal.fire(
                    "Hata",
                    "Kaydınız silinemedi",
                    "hata"
                )
            }
        });
        
    }

</script>